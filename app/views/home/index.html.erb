<%= javascript_include_tag "home.js" %>
<% if flash[:notice] %>
  <div class="notice" style= "color: red; margin-left:200px;"><%= flash[:notice] %></div>
<% end %>
  <nav id="top">
    <div class="container">
      <div class="row">
        <div class="col-sm-2">
          <h4>QUICK DEALS</h4>
        </div>
        <div class="col-sm-4">
          <span id="category" class="visible">
          <%= form_tag home_index_path, :method => 'get', :id =>"products_search", style: "padding: 2px" do %>
            <div class="col-lg-6">
              <div class="input-group" style = "width: 250%">
                <div class="ui-widget">
                  <%= text_field_tag :search, params[:search], :id =>"search_text", :placeholder=>"search", :class=>"form-control" %>
                </div>
              </div><!-- /input-group -->
            </div>
          <% end %>
         </span>
        </div>
        <div class="col-sm-3">
        <div id="cart" class="btn-group btn-block">
          <button type="button" data-loading-text="Loading..." class="btn btn-inverse btn-block btn-lg dropdown-toggle" style="width:200px;float:right;" data-toggle="modal" data-target="#myModal1"><i class="fa fa-shopping-cart"></i>
            <span id="cart-total"></span>
          </button>
          <!-- modal for cart -->
          <div id="myModal1" class="modal fade" role="dialog">
            <div class="modal-dialog">

              <!-- Modal content-->
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4 class="modal-title1">Cart Menu</h4>
                </div>
                <div class="modal-body">
                  <p>ur cart is empty</p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
              </div>

            </div>
          </div>
          <!-- modal for checkout -->
          <ul class="dropdown-menu pull-right">
            <li>
              <p class="text-center">Your shopping cart is empty!</p>
            </li>
          </ul>
        </div>
      </div>
       <div class="col-sm-3">
          <div class="pull-left">
        <div class="btn-group">
        </div>
      </div>
      <div id="top-links" class="nav pull-right">
        <ul class="list-inline">
          <li class="dropdown">
            <% if user_signed_in? %>
              <li>
                  <%= link_to(current_user, user_path(current_user)) %>
              </li>
              <li>
                  <%= link_to "Sign Out", destroy_user_session_path, method: :delete %>
              </li>
            <% else %>
              <li>
                <button class="btn btn-primary btn-primary" data-toggle="modal" data-target="#myModal">
                  Register
                </button>
                <div class="modal fade" id="myModal" role="dialog">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Sign up</h4>
                      </div>
                      <div class="modal-body">
                        <div id='error'></div>
                        <div id='email_error'></div>
                        <%= form_for(resource, as: resource_name, url: registration_path(resource_name), :remote=>true) do |f| %>
                        <%= devise_error_messages! %>

                        <div class="field">
                          <div class="form-group field">
                            <%= f.label :First_name %><br />
                            <%= f.text_field :first_name, autofocus: true %>
                          </div>
                        </div>

                        <div class="field">
                          <div class="form-group field">
                            <%= f.label :Last_name %><br />
                            <%= f.text_field :last_name, autofocus: true %>
                          </div>
                        </div>

                        <div class="field">
                          <div class="form-group field">
                            <%= f.label :email %><br />
                            <%= f.email_field :email, autofocus: true %>
                          </div>
                        </div>

                        <div class="field">
                          <div class="form-group field">
                            <%= f.label :password %>
                            <% if @minimum_password_length %>
                            <em>(<%= @minimum_password_length %> characters minimum)</em>
                            <% end %><br />
                            <%= f.password_field :password, autocomplete: "off" %>
                          </div>
                        </div>

                        <div class="field">
                          <div class="form-group field">
                            <%= f.label :password_confirmation %><br />
                            <%= f.password_field :password_confirmation, autocomplete: "off" %>
                          </div>
                        </div>

                        <div class="actions">
                          <div class="form-group field">
                            <%= button_tag "Sign up", type: 'button', :id=>'signup', :class=>'btn btn-success' %>
                          </div>
                        </div>
                      <% end %>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
              <li>
                <button class="btn btn-primary btn-primary">
                  <%= link_to "Login", new_user_session_path %>
                </button>
              </li>
            <% end %>
          </li>
        </ul>
      </div>
       </div>
    </div>
  </div>
</nav>
<div class="container">
  <div class="row">
    <div id="content" class="col-sm-12">
      <div id="slideshow0" class="flexslider">
        <div class="flex-viewport" style="overflow: hidden; position: relative;">
          <ul class="slides" style="width: 100%; -webkit-transition-duration: 0.6s; transition-duration: 0.6s; -webkit-transform: translate3d(0px, 0px, 0px);">
            <li style="width: 1132px; float: left; display: block;">
              <img src="http://demo.opencart.com/image/cache/catalog/demo/banners/MacBookAir-1140x380.jpg" alt="MacBookAir" class="img-responsive" draggable="false">
            </li>
            <li style="width: 1132px; float: left; display: block;">
                <img src="http://demo.opencart.com/image/cache/catalog/demo/banners/iPhone6-1140x380.jpg" alt="iPhone 6" class="img-responsive" draggable="false">
            </li>
          </ul>
        </div>
      </div>
      <div class="row product-layout">
        <%= render partial: 'products' %>
      </div>
    </div>
  </div>
</div>
<style>
  .ui-autocomplete-category {
    font-weight: bold;
    padding: .2em .4em;
    margin: .8em 0 .2em;
    line-height: 1.5;
  }
</style>
<script>
$.widget( "custom.catcomplete", $.ui.autocomplete,{
    _create: function() {
        this._super();
        this.widget().menu( "option", "items", "> :not(.ui-autocomplete-category)" );
    },
    _renderMenu: function( ul, items ) {
        var that = this,
        currentCategory = "";
        $.each( items, function( index, item ) {
            var li;
            if ( item.category != currentCategory ) {
                ul.append( "<li class='autocompleltelist ui-autocomplete-category drop-down'>" + item.category + "</li>" );
                currentCategory = item.category;
            }
            li = that._renderItemData( ul, item );
            if ( item.category ) {
                li.attr( "aria-label", item.category + " : " + item.label );
                li.attr( "data-id", item.id );
                li.attr( "data-category", item.category );
                li.attr( "class", 'autocompletelist')
            }
        });
    }
});
</script>
<script>
$(window).load(function() {
    $('.flexslider').flexslider();
    $('.flex-next, .flex-prev').empty();
});
$(function () {
    $(".ui-autocomplete-category").on('click', function() {
        alert(1);
    });
    $("#search_text").on('keyup', function() {
    // var search_content =$("#search_text").val();
        $( "#search_text" ).catcomplete({
            delay: 0,
            select: function (e, ui) {
                $.ajax({
                    url: '/search_index',
                    type: 'GET',
                    dataType: 'json',
                    data: {
                        'id': ui.item.id,
                        'category' : ui.item.category
                    },
                    success: function(data){
                        var length = data.length;
                        var products = "";
                        for(var i=0; i<length; i++){
                            products += '<div class="col-lg-3 col-md-3 col-sm-6 col-xs-12"><div class="product-thumb transition" style="height: 250px; overflow:hidden;" >' +
                            '<div class="image">' + '<img src="' + data[i].avatar_url + '">' + '</div>' +
                            '<div class="caption"><h4>' + data[i].name + '<br></h4><p><strong>Category :</strong>'
                            + data[i].category_name + '<br><p class="price">' +
                            '<strong>Price :</strong>' + data[i].unit_price + '<br></p><p class="price">' +
                            '<strong>Quantity Remaining :</strong>' + data[i].quantity +'<br></p></p></div></div></div>';
                        }
                        $('#products-listing').html(products);
                    }
                });
            },
            source: function (request, response) {
                $.ajax({
                    url: '/index',
                    type: 'GET',
                    dataType: 'json',
                    data: {
                    'search': $("#search_text").val()
                    },
                    success: function(data){
                      response(data.products);
                          // $('#product-layout').html(data.html_string);
                    }
                });
            }
        });
    // return false;
    });
});

</script>



